<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Therapist Stage 1 - Visual System Guide</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 0;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .status-badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 16px;
            margin-top: 15px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 0;
        }

        .nav-bar {
            background: #34495e;
            padding: 15px 30px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .nav-bar a {
            color: white;
            text-decoration: none;
            margin-right: 25px;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-bar a:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 60px;
        }

        .section-title {
            font-size: 2em;
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-icon {
            font-size: 1.5em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .diagram-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 25px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .diagram-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .info-box {
            background: linear-gradient(to right, #e8f5e9, #c8e6c9);
            border-left: 5px solid #27ae60;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .warning-box {
            background: linear-gradient(to right, #ffebee, #ffcdd2);
            border-left: 5px solid #e74c3c;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .example-box {
            background: linear-gradient(to right, #fff9e6, #ffe6a3);
            border-left: 5px solid #f39c12;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .priority-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .priority-card {
            padding: 25px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .priority-1 { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .priority-2 { background: linear-gradient(135deg, #f39c12, #d68910); }
        .priority-3 { background: linear-gradient(135deg, #27ae60, #229954); }
        .priority-4 { background: linear-gradient(135deg, #3498db, #2980b9); }

        .priority-card h3 {
            font-size: 1.4em;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }

        .priority-card ul {
            list-style: none;
            padding-left: 0;
        }

        .priority-card li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .priority-card li:before {
            content: "▸";
            position: absolute;
            left: 5px;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95em;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr:nth-child(even) {
            background: #fafbfc;
        }

        .state-id {
            font-weight: bold;
            color: #2980b9;
            font-size: 1.1em;
        }

        .framework-badge {
            background: #e74c3c;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            display: inline-block;
        }

        code {
            background: #ecf0f1;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #e74c3c;
        }

        .flow-step {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .flow-step-title {
            font-weight: bold;
            color: #2980b9;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .arrow {
            text-align: center;
            font-size: 2em;
            color: #3498db;
            margin: 10px 0;
        }

        .footer {
            background: #34495e;
            color: white;
            padding: 30px;
            text-align: center;
            margin-top: 60px;
        }

        .footer p {
            margin: 10px 0;
        }

        @media print {
            .nav-bar {
                position: relative;
            }
            .stat-card, .priority-card {
                break-inside: avoid;
            }
        }

        .scroll-hint {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🧠 AI Therapist Stage 1</h1>
        <div class="subtitle">Complete Visual System Guide</div>
        <div class="status-badge">✅ PRODUCTION READY</div>
    </div>

    <div class="container">
        <div class="nav-bar">
            <a href="#overview">📊 Overview</a>
            <a href="#flow">🔄 System Flow</a>
            <a href="#priority">⚡ Priority Routing</a>
            <a href="#states">📋 All States</a>
            <a href="#examples">💡 Examples</a>
            <a href="#diagrams">📈 Diagrams</a>
        </div>

        <div class="content">
            <!-- OVERVIEW SECTION -->
            <div id="overview" class="section">
                <h2 class="section-title">
                    <span class="section-icon">📊</span>
                    System Overview
                </h2>

                <div class="info-box">
                    <strong>🎯 What Is This System?</strong><br>
                    An AI-powered conversation management system that guides clients through Stage 1 of Dr. Q's Trauma Resiliency Training (TRT) methodology.
                    It uses LLaMA AI for semantic understanding, retrieves examples from real Dr. Q sessions, and triggers therapeutic frameworks at appropriate moments.
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">31</div>
                        <div class="stat-label">Total States</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">31</div>
                        <div class="stat-label">Intents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">10</div>
                        <div class="stat-label">Detections</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">28</div>
                        <div class="stat-label">RAG Queries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Framework Triggers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">Test Pass Rate</div>
                    </div>
                </div>
            </div>

            <!-- SYSTEM FLOW SECTION -->
            <div id="flow" class="section">
                <h2 class="section-title">
                    <span class="section-icon">🔄</span>
                    How The System Works
                </h2>

                <div class="flow-step">
                    <div class="flow-step-title">Step 1: Client Message Arrives</div>
                    <p>Client sends a message: <em>"I think back then my chest felt tight"</em></p>
                </div>

                <div class="arrow">↓</div>

                <div class="flow-step">
                    <div class="flow-step-title">Step 2: Master Agent (LLaMA) Analyzes</div>
                    <p><strong>Intent Classification:</strong> What is the client trying to communicate?</p>
                    <p><strong>Detections:</strong> Context flags detected</p>
                    <ul>
                        <li><code>self_harm</code>: False</li>
                        <li><code>thinking_mode</code>: True ("I think")</li>
                        <li><code>tense</code>: 'past' ("back then")</li>
                        <li><code>body_words</code>: True ("chest", "tight")</li>
                    </ul>
                </div>

                <div class="arrow">↓</div>

                <div class="flow-step">
                    <div class="flow-step-title">Step 3: Priority Routing</div>
                    <p><strong>Priority Check:</strong></p>
                    <ol>
                        <li>Self-harm? <span style="color: #27ae60;">✓ No</span></li>
                        <li>Thinking mode? <span style="color: #e74c3c;">✗ YES!</span> → Route to THINK state</li>
                    </ol>
                </div>

                <div class="arrow">↓</div>

                <div class="flow-step">
                    <div class="flow-step-title">Step 4: CSV State Lookup</div>
                    <p>Get information for <strong>THINK</strong> state:</p>
                    <ul>
                        <li>RAG Query: <code>dr_q_think_redirect</code></li>
                        <li>Fallback: "Rather than thinking, what are you FEELING?"</li>
                    </ul>
                </div>

                <div class="arrow">↓</div>

                <div class="flow-step">
                    <div class="flow-step-title">Step 5: Dialogue Agent Generates Response</div>
                    <p><strong>RAG (Vector DB):</strong> Retrieves similar Dr. Q examples</p>
                    <p><strong>LLaMA Dialogue Agent:</strong> Generates natural response in Dr. Q's style</p>
                    <p><strong>Output:</strong> <em>"Let's pause the thinking. What are you FEELING in your body right now?"</em></p>
                </div>

                <div class="arrow">↓</div>

                <div class="flow-step">
                    <div class="flow-step-title">Step 6: Response Sent to Client</div>
                    <p>Client receives therapeutic response and conversation continues</p>
                </div>
            </div>

            <!-- PRIORITY ROUTING SECTION -->
            <div id="priority" class="section">
                <h2 class="section-title">
                    <span class="section-icon">⚡</span>
                    Priority Routing System
                </h2>

                <div class="warning-box">
                    <strong>⚠️ Important:</strong> Priority routing can interrupt the normal flow from ANY state.
                    Safety (Priority 1) is the highest priority and overrides everything else.
                </div>

                <div class="priority-grid">
                    <div class="priority-card priority-1">
                        <h3>🔴 Priority 1: SAFETY</h3>
                        <p style="margin: 10px 0;"><strong>Highest Priority - Overrides Everything</strong></p>
                        <ul>
                            <li>Self-harm detection</li>
                            <li>Routes to SELFHARM state</li>
                            <li>Triggers no_harm framework</li>
                            <li>Immediate intervention</li>
                        </ul>
                    </div>

                    <div class="priority-card priority-2">
                        <h3>🟠 Priority 2: THERAPEUTIC REDIRECTS</h3>
                        <p style="margin: 10px 0;"><strong>Keep Client Present & Feeling</strong></p>
                        <ul>
                            <li>THINK: thinking → feeling</li>
                            <li>PAST: past tense → present</li>
                            <li>Max 3 attempts, then escape to alpha</li>
                            <li>Loop prevention built-in</li>
                        </ul>
                    </div>

                    <div class="priority-card priority-3">
                        <h3>🟢 Priority 3: AFFIRMATION</h3>
                        <p style="margin: 10px 0;"><strong>Validate Present Body Awareness</strong></p>
                        <ul>
                            <li>Body words + present tense</li>
                            <li>Just affirm: "That's right."</li>
                            <li>Use 60%+ of time</li>
                            <li>Builds therapeutic rapport</li>
                        </ul>
                    </div>

                    <div class="priority-card priority-4">
                        <h3>🔵 Priority 4: SPECIAL STATES</h3>
                        <p style="margin: 10px 0;"><strong>Handle Edge Cases</strong></p>
                        <ul>
                            <li>CRISIS: severe panic/incoherent</li>
                            <li>RESISTANCE: "not helping"</li>
                            <li>RAMBLING: excessive detail</li>
                            <li>EMOTION: high intensity</li>
                            <li>And 6 more special states</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- DIAGRAMS SECTION -->
            <div id="diagrams" class="section">
                <h2 class="section-title">
                    <span class="section-icon">📈</span>
                    System Flow Diagrams
                </h2>

                <div class="diagram-container">
                    <div class="diagram-title">Main Progression Flow (Happy Path)</div>
                    <div class="mermaid">
graph TD
    Start([Client Enters]) --> 1.1[1.1 Goal Inquiry]

    1.1 -->|Goal Stated| 1.2[1.2 Build Vision]
    1.1 -->|Vague Problem| 1.1_r[1.1_redirect]
    1.1_r -->|Goal Clarified| 1.2

    1.2 -->|Accepts Vision| 1.3[1.3 Get Permission]

    1.3 -->|Permission Granted| 2.1[2.1 Problem Inquiry]

    2.1 -->|Has Body Words| 2.2[2.2 Body Location]
    2.1 -->|No Body Words| 2.1_s[2.1_seek]

    2.1_s -->|Body Mentioned| 2.2
    2.1_s -->|3 Attempts Failed| CARD[Card Game]
    CARD --> 2.2

    2.2 --> 2.3[2.3 Sensation Quality]
    2.3 --> 2.4[2.4 Present Check]
    2.4 --> 2.5[2.5 Pattern Inquiry]
    2.5 --> 3.1[3.1 Assess Readiness]

    3.1 --> 3.2[3.2 Introduce Alpha]
    3.2 --> 3.3[3.3 Execute Alpha<br/>⚡Framework]
    3.3 --> 3.4[3.4 Post-Alpha]
    3.4 --> 3.5[3.5 Link to Vision]
    3.5 --> 3.6[3.6 Compare Progress]
    3.6 --> 4.1[4.1 Ready Stage 2]
    4.1 --> STAGE2([Begin Stage 2])

    style 1.1 fill:#e1f5ff
    style 2.1 fill:#fff4e6
    style 3.3 fill:#ffe6e6
    style 4.1 fill:#e6ffe6
    style CARD fill:#ffccff
                    </div>
                </div>

                <div class="diagram-container">
                    <div class="diagram-title">Priority Routing System</div>
                    <div class="mermaid">
graph TD
    ANY[ANY STATE] --> PRIORITY{Priority<br/>Detection}

    PRIORITY -->|1. Self-Harm<br/>HIGHEST| SELFHARM[SELFHARM State<br/>⚡no_harm framework]
    PRIORITY -->|2. Thinking Mode| THINK[THINK State<br/>MAX 3 attempts]
    PRIORITY -->|3. Past Tense| PAST[PAST State<br/>MAX 3 attempts]
    PRIORITY -->|4. Body + Present| AFFIRM[AFFIRM State]
    PRIORITY -->|5. Normal| NORMAL[Continue<br/>Normal Flow]

    SELFHARM -->|Engaged| RETURN1[Handle Safety]
    THINK -->|Feeling Response| RETURN2[Return to Flow]
    THINK -->|3 Attempts| ESCAPE_THINK[Escape to 3.2<br/>Alpha Grounding]
    PAST -->|Present Response| RETURN3[Return to Flow]
    PAST -->|3 Attempts| ESCAPE_PAST[Escape to 3.2<br/>Alpha Anchoring]
    AFFIRM --> RETURN4[Continue Flow]
    NORMAL --> RETURN5[Continue Flow]

    style SELFHARM fill:#ff6b6b
    style THINK fill:#ffd43b
    style PAST fill:#ffd43b
    style AFFIRM fill:#51cf66
                    </div>
                </div>

                <div class="diagram-container">
                    <div class="diagram-title">Complete System Architecture</div>
                    <div class="mermaid">
graph TB
    CLIENT[Client Message] --> MASTER[Master Agent LLaMA]

    MASTER --> DET1{Self-Harm?}
    DET1 -->|Yes| SELF[SELFHARM + no_harm]
    DET1 -->|No| DET2{Thinking?}

    DET2 -->|Yes| TH[THINK State]
    DET2 -->|No| DET3{Past?}

    DET3 -->|Yes| PA[PAST State]
    DET3 -->|No| DET4{Body+Present?}

    DET4 -->|Yes| AFF[AFFIRM State]
    DET4 -->|No| CSV[CSV State Lookup]

    CSV --> STATE[Current State Info]
    STATE --> CHECK{Framework<br/>Trigger?}

    CHECK -->|alpha_sequence| ALPHA_F[Execute Alpha]
    CHECK -->|no_harm| HARM_F[Execute no_harm]
    CHECK -->|card_game| CARD_F[Execute card_game]
    CHECK -->|None| RAG[RAG Query]

    ALPHA_F --> RAG
    HARM_F --> RAG
    CARD_F --> RAG

    RAG --> VDB[Vector Database]
    VDB --> DIALOG[Dialogue Agent LLaMA]

    DIALOG --> RESPONSE[Therapist Response]
    RESPONSE --> NEXT[Determine Next State]
    NEXT --> CLIENT

    style MASTER fill:#e1f5ff
    style CSV fill:#fff4e6
    style VDB fill:#e6ffe6
    style DIALOG fill:#ffe6f7
    style SELF fill:#ff6b6b
                    </div>
                </div>
            </div>

            <!-- EXAMPLES SECTION -->
            <div id="examples" class="section">
                <h2 class="section-title">
                    <span class="section-icon">💡</span>
                    Real-World Examples
                </h2>

                <div class="example-box">
                    <strong>Example 1: Priority Override (Self-Harm)</strong><br><br>
                    <strong>Current State:</strong> 2.3 (Sensation Quality)<br>
                    <strong>Client Says:</strong> "I just want it all to end. I've been thinking about hurting myself."<br><br>
                    <strong>System Response:</strong><br>
                    1. Master Agent detects: <code>self_harm=True</code><br>
                    2. Priority 1 triggers → Routes to SELFHARM state<br>
                    3. Triggers ⚡ no_harm framework<br>
                    4. Therapist: "I hear you're having thoughts of hurting yourself. Your safety is important. Let's talk about this."<br>
                    5. Safety assessment begins
                </div>

                <div class="example-box">
                    <strong>Example 2: Loop Prevention</strong><br><br>
                    <strong>Current State:</strong> 2.1_seek (Seek Body)<br>
                    <strong>Attempt 1:</strong> "Where do you feel it in your body?"<br>
                    <strong>Client:</strong> "I don't feel anything. It's just work stress."<br>
                    → Loop counter: 1<br><br>
                    <strong>Attempt 2:</strong> "Is there any sensation anywhere?"<br>
                    <strong>Client:</strong> "No, it's external."<br>
                    → Loop counter: 2<br><br>
                    <strong>Attempt 3:</strong> Loop counter: 3 → ESCAPE TRIGGERED<br>
                    → Triggers ⚡ card_game framework OR skips to 3.1<br>
                    → System never gets stuck!
                </div>

                <div class="example-box">
                    <strong>Example 3: Normal Flow with Affirmation</strong><br><br>
                    <strong>Current State:</strong> 2.4 (Present Check)<br>
                    <strong>Client Says:</strong> "Yes, I feel the tightness in my chest right now."<br><br>
                    <strong>System Response:</strong><br>
                    1. Master Agent detects: <code>body_words=True</code>, <code>tense='present'</code><br>
                    2. Priority 3 triggers → Routes to AFFIRM state<br>
                    3. Therapist: "That's right." (60%+ usage for natural flow)<br>
                    4. Returns to normal flow → Proceeds to 2.5 (Pattern Inquiry)
                </div>

                <div class="example-box">
                    <strong>Example 4: Thinking Mode Redirect</strong><br><br>
                    <strong>Current State:</strong> 2.5 (Pattern Inquiry)<br>
                    <strong>Client Says:</strong> "I think it's because when I was younger, I developed this pattern..."<br><br>
                    <strong>System Response:</strong><br>
                    1. Master Agent detects: <code>thinking_mode=True</code>, <code>tense='past'</code><br>
                    2. Priority 2 triggers → Routes to THINK state (thinking takes precedence over past)<br>
                    3. Loop counter[THINK]: 1<br>
                    4. Therapist: "Rather than thinking about it, what are you FEELING right now?"<br>
                    5. If client continues thinking after 3 attempts → Escape to 3.2 (alpha grounding)
                </div>
            </div>

            <!-- ALL STATES TABLE -->
            <div id="states" class="section">
                <h2 class="section-title">
                    <span class="section-icon">📋</span>
                    Complete State Reference (31 States)
                </h2>

                <p class="scroll-hint">Scroll horizontally to see all columns →</p>

                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>State ID</th>
                                <th>State Name</th>
                                <th>Client Example</th>
                                <th>Intent</th>
                                <th>Next State</th>
                                <th>Action/RAG Query</th>
                                <th>Framework</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- SECTION 1 -->
                            <tr style="background: #e3f2fd;">
                                <td colspan="7"><strong>SECTION 1: GOAL & VISION</strong></td>
                            </tr>
                            <tr>
                                <td class="state-id">1.1</td>
                                <td>Goal Inquiry</td>
                                <td>I'm stressed, overwhelmed</td>
                                <td>session_start</td>
                                <td>1.2 or 1.1_redirect</td>
                                <td><code>dr_q_goal_inquiry</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">1.1_redirect</td>
                                <td>Redirect to Goal</td>
                                <td>Work is hectic</td>
                                <td>describes_problem</td>
                                <td>1.2</td>
                                <td><code>dr_q_redirect_outcome</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">1.2</td>
                                <td>Build Vision</td>
                                <td>I want to feel peaceful</td>
                                <td>states_goal</td>
                                <td>1.3</td>
                                <td><code>dr_q_vision</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">1.3</td>
                                <td>Get Permission</td>
                                <td>Yes that's exactly what I want</td>
                                <td>accepts_vision</td>
                                <td>2.1</td>
                                <td><code>dr_q_permission</code></td>
                                <td>-</td>
                            </tr>

                            <!-- SECTION 2 -->
                            <tr style="background: #fff3e0;">
                                <td colspan="7"><strong>SECTION 2: BODY AWARENESS</strong></td>
                            </tr>
                            <tr>
                                <td class="state-id">2.1</td>
                                <td>Problem Inquiry</td>
                                <td>[permission granted]</td>
                                <td>permission_granted</td>
                                <td>2.2 or 2.1_seek</td>
                                <td><code>dr_q_problem</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">2.1_seek</td>
                                <td>Seek Body</td>
                                <td>Deadlines, pressure</td>
                                <td>no_body_awareness</td>
                                <td>2.2 or ESCAPE</td>
                                <td><code>dr_q_to_body</code></td>
                                <td><span class="framework-badge">card_game (attempt 3)</span></td>
                            </tr>
                            <tr>
                                <td class="state-id">2.2</td>
                                <td>Body Location</td>
                                <td>Chest feels tight</td>
                                <td>mentions_body</td>
                                <td>2.3</td>
                                <td><code>dr_q_location</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">2.3</td>
                                <td>Sensation Quality</td>
                                <td>Right leg, below knee</td>
                                <td>gives_location</td>
                                <td>2.4</td>
                                <td><code>dr_q_sensation</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">2.4</td>
                                <td>Present Check</td>
                                <td>It's an ache, heavy weight</td>
                                <td>describes_sensation</td>
                                <td>2.5</td>
                                <td><code>dr_q_present_check</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">2.5</td>
                                <td>Pattern Inquiry</td>
                                <td>Yes I feel it now</td>
                                <td>present_aware</td>
                                <td>3.1</td>
                                <td><code>dr_q_how_know</code></td>
                                <td>-</td>
                            </tr>

                            <!-- SECTION 3 -->
                            <tr style="background: #fce4ec;">
                                <td colspan="7"><strong>SECTION 3: ALPHA SEQUENCE</strong></td>
                            </tr>
                            <tr>
                                <td class="state-id">3.1</td>
                                <td>Assess Readiness</td>
                                <td>Calendar triggers thoughts</td>
                                <td>pattern_identified</td>
                                <td>3.2</td>
                                <td><code>dr_q_ready</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">3.2</td>
                                <td>Introduce Alpha</td>
                                <td>No, that covers it</td>
                                <td>ready_for_alpha</td>
                                <td>3.3</td>
                                <td><code>dr_q_alpha_intro</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">3.3</td>
                                <td>Execute Alpha</td>
                                <td>Okay I'm ready</td>
                                <td>accepts_alpha</td>
                                <td>3.4</td>
                                <td>-</td>
                                <td><span class="framework-badge">⚡ alpha_sequence</span></td>
                            </tr>
                            <tr>
                                <td class="state-id">3.4</td>
                                <td>Post-Alpha</td>
                                <td>[alpha complete]</td>
                                <td>alpha_done</td>
                                <td>3.5</td>
                                <td><code>dr_q_post_alpha</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">3.5</td>
                                <td>Link to Vision</td>
                                <td>I felt free</td>
                                <td>positive_response</td>
                                <td>3.6</td>
                                <td><code>dr_q_link</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">3.6</td>
                                <td>Compare Progress</td>
                                <td>[vision linked]</td>
                                <td>linked</td>
                                <td>4.1</td>
                                <td><code>dr_q_compare</code></td>
                                <td>-</td>
                            </tr>

                            <!-- SECTION 4 -->
                            <tr style="background: #e8f5e9;">
                                <td colspan="7"><strong>SECTION 4: TRANSITION</strong></td>
                            </tr>
                            <tr>
                                <td class="state-id">4.1</td>
                                <td>Ready Stage 2</td>
                                <td>Better, calmer</td>
                                <td>improved</td>
                                <td>STAGE 2</td>
                                <td><code>dr_q_transition</code></td>
                                <td>-</td>
                            </tr>

                            <!-- PRIORITY REDIRECTS -->
                            <tr style="background: #fff9c4;">
                                <td colspan="7"><strong>PRIORITY REDIRECTS (Can Interrupt ANY State)</strong></td>
                            </tr>
                            <tr>
                                <td class="state-id">THINK</td>
                                <td>Redirect Thinking</td>
                                <td>I think it's because...</td>
                                <td>thinking_mode</td>
                                <td>continue or 3.2</td>
                                <td><code>dr_q_think_redirect</code></td>
                                <td>Max 3 → alpha</td>
                            </tr>
                            <tr>
                                <td class="state-id">PAST</td>
                                <td>Redirect Past</td>
                                <td>Back then when I was...</td>
                                <td>past_tense</td>
                                <td>continue or 3.2</td>
                                <td><code>dr_q_past_redirect</code></td>
                                <td>Max 3 → alpha</td>
                            </tr>
                            <tr>
                                <td class="state-id">AFFIRM</td>
                                <td>Just Affirm</td>
                                <td>I feel tightness now</td>
                                <td>body_present</td>
                                <td>continue</td>
                                <td><code>dr_q_affirm</code></td>
                                <td>60%+ usage</td>
                            </tr>

                            <!-- SPECIAL STATES -->
                            <tr style="background: #ffcccc;">
                                <td colspan="7"><strong>SPECIAL STATES (High Priority)</strong></td>
                            </tr>
                            <tr>
                                <td class="state-id">SELFHARM</td>
                                <td>Self-Harm Mention</td>
                                <td>I want to hurt myself</td>
                                <td>self_harm_detected</td>
                                <td>assess_safety</td>
                                <td>Safety protocol</td>
                                <td><span class="framework-badge">⚡ no_harm</span></td>
                            </tr>
                            <tr>
                                <td class="state-id">CRISIS</td>
                                <td>Acute Crisis</td>
                                <td>[incoherent/panic]</td>
                                <td>crisis_state</td>
                                <td>continue or emergency</td>
                                <td>Crisis assessment</td>
                                <td><span class="framework-badge">⚡ no_harm</span></td>
                            </tr>
                            <tr>
                                <td class="state-id">RESISTANCE</td>
                                <td>Client Resistant</td>
                                <td>This isn't helping</td>
                                <td>resistant</td>
                                <td>continue</td>
                                <td><code>dr_q_resistance</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">RAMBLING</td>
                                <td>Excessive Detail</td>
                                <td>Back in 1987...</td>
                                <td>rambling</td>
                                <td>2.2 or firmer</td>
                                <td><code>dr_q_interrupt</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">EMOTION</td>
                                <td>Strong Emotion</td>
                                <td>I'M SO STRESSED!!!</td>
                                <td>high_intensity</td>
                                <td>continue</td>
                                <td><code>dr_q_validate</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">CRY</td>
                                <td>Client Crying</td>
                                <td>[crying]</td>
                                <td>crying</td>
                                <td>continue</td>
                                <td><code>dr_q_cry</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">SILENT</td>
                                <td>Not Speaking</td>
                                <td>Um... [pause]</td>
                                <td>silence</td>
                                <td>continue</td>
                                <td><code>dr_q_prompt</code></td>
                                <td><span class="framework-badge">card_game</span></td>
                            </tr>
                            <tr>
                                <td class="state-id">OFF</td>
                                <td>Off Topic</td>
                                <td>Did you see the game?</td>
                                <td>off_topic</td>
                                <td>continue</td>
                                <td><code>dr_q_redirect</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">VALID</td>
                                <td>Seek Validation</td>
                                <td>Is this normal?</td>
                                <td>validation</td>
                                <td>continue</td>
                                <td><code>dr_q_normalize</code></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td class="state-id">RELATION</td>
                                <td>Relational Pattern</td>
                                <td>Need to make everyone happy</td>
                                <td>people_pleasing</td>
                                <td>continue</td>
                                <td><code>dr_q_relational</code></td>
                                <td>-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>🧠 AI Therapist Stage 1 - Visual System Guide</strong></p>
            <p>Status: ✅ Production Ready | Total States: 31 | Test Pass Rate: 100%</p>
            <p>Date: 2025-10-08 | TRT Methodology | LLM-Augmented State Machine</p>
            <p style="margin-top: 15px; opacity: 0.8;">Built with Dr. Q's Trauma Resiliency Training methodology</p>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>
